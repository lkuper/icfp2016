<!doctype html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <title>visualizer</title>
  <style>
    svg#visualization {
      border: 1px solid #666;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    textarea#theproblem {
      background: #ddd;
    }
  </style>
</head>
<body>

<svg id="visualization" width="400" height="400"></svg>

<h1>put problem here:</h1>

<input type="file" onchange="readProblem()" />

<script>

function readProblem() {
    contents = "";

    var file = document.querySelector('input[type=file]').files[0];
    var reader = new FileReader();

    reader.addEventListener("load", function() {
        contents = reader.result;
        drawFromJSON(contents);
    }, false);

    if (file) {
        reader.readAsText(file);
    }

}

function addLine(point1, point2, color) {
  var svg = document.getElementById("visualization");

  var x1 = point1[0];
  var x2 = point2[0];
  var y1 = -point1[1];
  var y2 = -point2[1];

  var line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
  line.setAttribute('x1', x1);
  line.setAttribute('y1', y1);
  line.setAttribute('x2', x2);
  line.setAttribute('y2', y2);
  line.setAttribute('stroke', color);
  line.setAttribute('stroke-width', 0.005);
  svg.appendChild(line);
}

function clear_visualization() {
  var svg = document.getElementById("visualization");
  while (svg.firstChild)
    svg.removeChild(svg.firstChild);
}

function draw(leastright_x, leastup_y, rightest_x, uppest_y) {
    console.log([leastright_x, leastup_y, rightest_x, uppest_y]);
    var viewbox = [leastright_x - 0.01, (-uppest_y) - 0.01,
                   (rightest_x - leastright_x) + 0.02,
                   (uppest_y - leastup_y) + 0.02].join(" ");
    console.log(viewbox);
    var svg = document.getElementById("visualization");
    svg.setAttribute("viewBox", viewbox);
}

function drawFromJSON(jsonString) {
    clear_visualization();

    rightest_x = Number.MIN_VALUE;
    uppest_y = Number.MIN_VALUE;
    leastright_x = Number.MAX_VALUE;
    leastup_y = Number.MAX_VALUE;

    problem = JSON.parse(jsonString);
    var skeleton = problem["skeleton"]
    var polygons = problem;
    delete polygons["skeleton"] // destructive!

    // draw skeleton
    for (var i in skeleton) {
        var endpoints = skeleton[i];
        addLine(endpoints[0], endpoints[1], "lightgrey")
    }

    // draw silhouette
    for (var polygon_id in polygons) {
        var points = polygons[polygon_id];

        for (var point in points) {
            x_coord = parseFloat(points[point][0]);
            y_coord = parseFloat(points[point][1]);

            rightest_x = Math.max(x_coord, rightest_x);
            uppest_y = Math.max(y_coord, uppest_y);
            leastright_x = Math.min(x_coord, leastright_x);
            leastup_y = Math.min(y_coord, leastup_y);
        }

        for (var point = 1; point < points.length; point++) {
            addLine(points[point], points[point - 1], "black");
        }
        addLine(points[points.length - 1], points[0], "black");
    }

    draw(leastright_x, leastup_y, rightest_x, uppest_y);
} 

</script>

</body>
</html>
